<!DOCTYPE html>
<html>
    <head>
        <script src="//code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="js/wikigetter.js"></script>
        <link rel="stylesheet" href="dist/reveal.css">
        <link rel="stylesheet" href="dist/theme/white.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/3.4.0/css/bootstrap-colorpicker.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/stylesheet.css">       
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section id ="title-slide">
                <div id="title" >Test</div>
                <p>Click on the bottom left, scroll your mousewheel, or swipe to present.</p>
                </section>
                <section>
                    <div>The End</div>
                    <p>Code by <a href="https://ambiguousname.github.io/" target="_blank">ambiguousname</a></p>
                    <p>
                        Uses
                        <a href="https://revealjs.com" target="_blank">reveal.js</a>,
                        <a href="https://jquery.com/" target="_blank">Jquery</a>,
                        <a href="https://getbootstrap.com/" target="_blank">Bootstrap</a>,
                        and <a href="https://itsjavi.com/bootstrap-colorpicker/index.html" target="_blank">Bootstrap-Colorpicker</a>
                    </p>
                    <p>Images and Text from <a href="https://wikihow.com/" target="_blank">wikiHow</a>.</p>
                    <p>Play this slideshow again with this code: <textarea id="codeText" style="height:1.5rem;"></textarea></p>
                    <p>
                        <button class="btn btn-primary shadow-none" onclick="copyToClipboard()">Copy code to clipboard</button>
                        <button class="btn btn-primary shadow-none" onclick="resetSlideshow()">Go Again?</button></p>
                    </section>
            </div>
        </div>
        <div class="centered">
            <div id="acknowledgement" style="display:inline;">
                <p>What follows is a bunch of random data gathered from wikiHow.</p>
                <p>In a few seconds, you might see untold horrors sprouted from the wastes of human thought.</p>
                <button type="button" class="btn btn-primary shadow-none" onclick="hideAcknowledge()">I am okay with this.</button>
            </div>
            <div id="customize" style="display: none;">
                <p>Primary Color <input type="text" class="color" id="primary-color" value="#fff"></p>
                <p>Secondary Color <input type="text" class="color" id="secondary-color" value="#000"></p>
                <p>Font Family <select class="form-select" name="font" id="font" oninput="updateFont()">
                    <option value="Segoe UI">Segoe UI</option>
                    <option value="Arial">Arial</option>
                    <option value="Brush Script MT">Brush Script MT</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                    <option value="Courier New">Courier New</option>
                    <option value="Garamond">Garamond</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Papyrus">Papyrus</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                </select></p>
                <p>Font Size <input type="number" id="fontSize" value="16" min=1 max=50 oninput="updateSize()">px</p>
                <p>Number of Images <input type="number" id="imageSize" value="6" min=1 max=10 oninput="updateImageSize()"></p>
                <p>Code (Optional) <input type="text" value="" id="presentcode"/></p>
                <button class="btn btn-primary shadow-none" onclick="resetSettings()">Reset to Default</button>
                <button class="btn btn-primary shadow-none" onclick="present()">Present!</button>
                </p>
            </div>
            <div style="display:none; width:50%;" class="progress">
                <div id="loading" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%;">0%</div>
            </div>
        </div>
        <script src="js/settings.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <script src="dist/reveal.js"></script>
        <script src="js/game.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/3.4.0/js/bootstrap-colorpicker.min.js"></script>
        <script>
            if (localStorage.getItem("acknowledged") !== null){
                $("#acknowledgement").hide();
                $("#customize").show();
            }

            let primary = localStorage.getItem("primary-color");
            if (primary !== null){
                $("#primary-color").val(primary);
                changePrimaryColor();
            }
            let secondary = localStorage.getItem("secondary-color");
            if (secondary !== null){
                $("#secondary-color").val(secondary);
                changeSecondaryColor();
            }

            let imageSize = localStorage.getItem("image-size");

            if (imageSize !== null){
                $("#imageSize").val(imageSize);
            } else {
                imageSize = 6;
            }

            let gm = new GameManager(imageSize, function(){
                $(".centered").hide();
                Reveal.initialize({controlsTutorial: true, controlsBackArrows: "visible", mouseWheel: true, transition: "slide"}).then(function(){  
                    updateSlideColors();
                });

                // If we're at the last slide, we want to stop storing the current slideshow to allow for new ones:
                Reveal.on('slidechange', function(event){
                    if (Reveal.isLastSlide()){
                        localStorage.removeItem("title");
                        localStorage.removeItem("images");
                    }
                });
            });

            // If we have parameters:
            if (window.location.href.includes("?")){
                gm.dataFromURL(window.location.href.split("?")[1]);
                if (gm.title !== ""){
                    $(".centered").hide();
                    gm.createSlideshow();
                }
            }
            
            async function present(){
                // Just in case size changes:
                updateSlideColors();
                let code = $("#presentcode").val();
                if (code.length > 0){
                    gm.dataFromURL(code);
                    if (gm.title !== ""){
                        $(".centered").hide();
                        gm.createSlideshow();
                    }
                } else {
                    $("#customize").fadeOut(500, function(){
                        $(".progress").show();
                        var interval = setInterval(function(){
                            let percent = (gm.progress * 100) + "%";
                            $("#loading").css("width", percent);
                            $("#loading").text(percent);
                            if (gm.isDone){
                                clearInterval(interval);
                            }
                        }, 500);
                    });
                    //gm.getGameData();
                }
            }

            function resetSlideshow(){
                Reveal.destroy();
                $("#customize").show();
                $(".progress").hide();
                $(".centered").show();
            }
            
            $(function(){
                $(".color").colorpicker();
                $("#primary-color").on("colorpickerChange", changePrimaryColor);
                $("#secondary-color").on("colorpickerChange", changeSecondaryColor);

                let font = localStorage.getItem("font");
                if (font !== null){
                    $("#font").val(font);
                    updateFont();
                }

                let fontSize = localStorage.getItem("font-size");
                if (fontSize !== null){
                    $("#fontSize").val(fontSize);
                    updateSize();
                }
            });

            function updateImageSize(){
                var size = parseInt($("#imageSize").val());

                if (size > $("#imageSize").attr("max")){
                    size = $("#imageSize").attr("max");
                }
                if (size < $("#imageSize").attr("min")){
                    size = $("#imageSize").attr("min");
                }
                $("#imageSize").val(size);
                gm.numImages = size;
                localStorage.setItem("image-size", size);
            }
        </script>
    </body>
</html>